<!DOCTYPE html>
<html>
<head>
    <title>Local API Connectivity Tester</title>
    <style>
        body { background: #111; color: #ddd; font-family: monospace; padding: 20px; }
        .log-entry { margin: 5px 0; border-bottom: 1px solid #333; padding: 5px; }
        .error { color: #ff5555; }
        .success { color: #55ff55; }
        .info { color: #55aaff; }
        button { padding: 10px 20px; font-size: 1.2em; cursor: pointer; background: #333; color: #fff; border: 1px solid #555; }
        button:hover { background: #444; }
    </style>
</head>
<body>
    <h1>// LOCAL API TESTER //</h1>
    <p>Target: <span id="target-display">172.16.1.24:8080</span></p>
    
    <button onclick="testNavigate()">Test POST /navigate</button>
    <button onclick="testSimpleGET()">Test GET / (Simple)</button>

    <h3>LOGS:</h3>
    <div id="console"></div>

    <script>
        // CONFIGURATION
        const TARGET_IP = "172.16.1.24"; // Replace with your target IP
        const PORT = "8080";
        const BASE_URL = `http://${TARGET_IP}:${PORT}`;

        function log(msg, type = "info") {
            const div = document.createElement("div");
            div.className = `log-entry ${type}`;
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById("console").prepend(div);
        }

        // TEST 1: The Complex POST (Mimicking your curl command)
        // This triggers a Preflight (OPTIONS) request due to the Content-Type header.
        function testNavigate() {
            log(`Attempting POST to ${BASE_URL}/navigate...`, "info");
            
            fetch(`${BASE_URL}/navigate`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json" // This header triggers CORS Preflight
                },
                body: JSON.stringify({
                    "page": "chrome://new-tab-page"
                })
            })
            .then(response => {
                if (response.ok) {
                    log("SUCCESS: Request sent and accepted.", "success");
                    return response.json();
                } else {
                    log(`SERVER ERROR: HTTP ${response.status}`, "error");
                }
            })
            .then(data => {
                if(data) log("Response Data: " + JSON.stringify(data), "success");
            })
            .catch(error => {
                // This is where CORS errors will appear
                log("FETCH FAILED: " + error.message, "error");
                log("Check your browser DevTools (F12) -> Console for specific CORS errors.", "error");
            });
        }

        // TEST 2: A Simple GET
        // Simple requests (GET/HEAD) are treated differently but may still fail reading the response.
        function testSimpleGET() {
            log(`Attempting GET to ${BASE_URL}/...`, "info");
            
            fetch(`${BASE_URL}/`, {
                method: "GET"
                // No custom headers
            })
            .then(response => {
                log(`Connected! Status: ${response.status}`, "success");
                return response.text();
            })
            .then(text => {
                log("Response Body: " + text, "success");
            })
            .catch(error => {
                log("FETCH FAILED: " + error.message, "error");
            });
        }
    </script>
</body>
</html>
